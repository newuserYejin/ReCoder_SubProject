<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

<!--Ìè∞Ìä∏ Ï†ÅÏö©-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/common/header.css}">
    <link rel="stylesheet" th:href="@{/css/common/footer.css}">
    <link rel="stylesheet" th:href="@{/css/common/style.css}">
    <!--Ïó¨Í∏∞ÍπåÏßÄ Í≥µÎèô Î≥µÏÇ¨-->

    <link rel="stylesheet" th:href="@{/css/mainPage/mainPage.css}">

</head>
<body>

    <header th:replace="~{common/header::headerFragment}"></header>
<!--    <section th:replace="~{/common/test::testFragment}"></section>-->
    <section>

<!--        <h1>Welcome, <span th:text="${userId}"></span>!</h1>-->

        <div class="holeContainer">
            <!-- ÌîÑÎ°úÌïÑ, ÎÇ†Ïî® API, ÏÇ¨ÎÇ¥ Î©îÏùº -->
            <div class="main_upperBox">
                <div class="profileWeather">
                    <div class="profile">
    <!--                    <p th:text="${LoginUserInfo ?: 'User information is not available'}"></p>-->
    <!--                    <p id="todayAtt"></p>-->
                        <div class="profileImg">
                            <img th:src="${LoginUserInfo != null ?
                                        ( LoginUserInfo.profile != null && LoginUserInfo.profile != '' && !LoginUserInfo.profile.isEmpty()
                                        ? 'uploadImg/' + LoginUserInfo.profile : 'uploadImg/defaultImg.png')
                                        : 'uploadImg/defaultImg.png'}">
    <!--                        <img src="../static/images/loopy.jpg">-->
                        </div>
                        <div class="profileInfo" th:if="${LoginUserInfo}">
                            <div class="firstLine">
                                <div th:text="|Ïù¥ Î¶Ñ : ${LoginUserInfo.empName}|"></div>
                                <p th:text="${LoginUserInfo.empId}"></p>
    <!--                         <div>Ïù¥ Î¶Ñ : ÌôçÍ∏∏Îèô</div>&ndash;&gt;-->
    <!--                         <p>12321</p>&ndash;&gt;-->
                                <button
                                        onclick="redirectBasedOnAuth()"
                                        id="linkedMyPage">
                                    + ÎçîÎ≥¥Í∏∞
                                </button>
                            </div>
                            <div class="secondLine" th:text="|Î∂Ä ÏÑú : ${LoginUserInfo.deptName}|"></div>
    <!--                    <div class="secondLine">Î∂Ä ÏÑú : ÌôçÎ≥¥Î∂Ä</div>-->

                            <div class="thirdLine">
                                <div th:text="|ÏßÅ Ï±Ö : ${LoginUserInfo.positionName}|"></div>
                                <div id="todayAtt"></div>

    <!--                        <div>ÏßÅ Ï±Ö : ÌåÄÏû•</div>-->
    <!--                        <div id="todayAtt">ÏßÄÍ∞Å</div>-->
                            </div>
                        </div>
                    </div>
                    <div class="WeatherAPIBox">

                    </div>
                </div>

                <div class="companyMailBox">
                    <div class="mailBoxTitleBox">
                        <div class="mailBoxTitle">ÏÇ¨ÎÇ¥ Î©îÏùº</div>
                        <div onclick="location.href='mail/receivedMails'">+ ÎçîÎ≥¥Í∏∞</div>
                    </div>

                    <div class="mailContent">
                        <div class="noMailMsg" th:if="!${receivedMails}">Î∞õÏùÄ Î©îÏùºÏù¥ ÏóÜÏäµÎãàÎã§.</div>

                        <div class="mailTh" th:if="${receivedMails}">
                            <div class="mailNum">Î≤àÌò∏</div>
                            <div class="sender">Î≥¥ÎÇ∏ÏÇ¨Îûå</div>
                            <div class="mailTitle">Ï†úÎ™©</div>
                            <div class="mailDate">ÏàòÏã†Ïùº</div>
                        </div>

                        <div th:onclick="|location.href='@{'/mail/detail'(emailId=${mail.value.mail.emailId})}'|" class="mailTd" th:each="mail, num : ${receivedMails}">
                            <div class="mailNum" th:text="${num.count}">Î≤àÌò∏</div>
                            <div class="sender" th:text="${mail.key}">Î≥¥ÎÇ∏ÏÇ¨Îûå</div>
                            <div class="mailTitle" th:text="${mail.value.mail.emailTitle}">Ï†úÎ™©</div>
                            <div class="mailDate" th:text="${mail.value.date}">ÏàòÏã†Ïùº</div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Ï∂úÏÑùÏ≤¥ÌÅ¨ Ïù¥Î≤§Ìä∏, Ìà¨Ìëú ÏöîÏïΩ, Í≤åÏãúÌåê -->
            <div class="main_footerBox">
            <div class="checkEvent">
                <div id='checkCalendar'></div>
            </div>
            <div class="voteBoardSummary">
                <div class="voteSummary">
                    <div class="voteTitleBox">
                        <div class="voteTitle">Ìà¨Ìëú</div>
                    </div>
                    <div class="voteNone" th:unless="${recently3List} != null">ÏïÑÏßÅ Ìà¨ÌëúÍ∞Ä ÏóÜÏäµÎãàÎã§.</div>
                    <div th:if="${recently3List}" th:each="post, postStat : ${recently3List}"  th:data-num="${postStat.index}" class="voteContentBoxBox">
                        <div class="voteContentBox">
                            <div class="prevBtn" th:id="|prevBtn_${postStat.index}|">
                                <img src="/images/angle-left-solid.svg" alt="ÏôºÏ™Ω Ïù¥Îèô">
                            </div>
                            <div class="voteContent">
                                <div class="voteContentGle" th:text="${post.postContent}"></div>
                            </div>
                            <div class="nextBtn" th:id="|nextBtn_${postStat.index}|">
                                <img src="/images/angle-right-solid.svg" alt="ÏôºÏ™Ω Ïù¥Îèô">
                            </div>
                        </div>
                        <button class="moveVote" th:onclick="|location.href = '@{/board/postDetail(postId=${post.postId}, categoryCode=4)}'|">Ìà¨ÌëúÌïòÎü¨ Í∞ÄÍ∏∞</button>
                    </div>
                </div>
                <div class="boardSummary">
                    <div class="totalBox">
                        <div class="boardTitleBox">
                            <div class="boardTitle">Í≤åÏãúÎ¨º</div>
                            <div onclick="location.href='board/list?categoryCode=1'">+ ÎçîÎ≥¥Í∏∞</div>
                        </div>

                        <div class="boardDataBox">
                            <!-- ÌÖåÏù¥Î∏î Ìó§Îçî -->
                            <div class="DataHeader">
                                <div>Î≤àÌò∏</div>
                                <div class="postEmpName">ÏûëÏÑ±Ïûê</div>
                                <div class="postTitle">Ï†úÎ™©</div>
                                <div class="postDate">ÏûëÏÑ±Ïùº</div>
                            </div>

                           <div class="DataBody">
                               <div class="MainData noPost" th:unless="${boardList} != null">ÏóÜÏùå</div>
                               <div th:onclick="|location.href='@{/board/postDetail(postId=${board.postId}, categoryCode=${1})}'|" class="MainData" th:if="${boardList} != null" th:each="board, boardStat : ${boardList}">
                                   <div th:text="${boardStat.count}"></div>
                                   <div class="postEmpName" th:text="${board.empName}"></div>
                                   <div class="postTitle" th:text="${board.postTitle}"></div>
                                   <div class="postDate" th:text="${#temporals.format(board.postCreationDate, 'yyyy-MM-dd')}"></div>
                               </div>
                           </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

    </section>
    <footer th:replace="~{common/footer::footerFragment}"></footer>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('checkCalendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth', // Ï¥àÍ∏∞ Î°úÎìú Îê†Îïå Î≥¥Ïù¥Îäî Ï∫òÎ¶∞Îçî ÌôîÎ©¥(Í∏∞Î≥∏ ÏÑ§Ï†ï: Îã¨)
                headerToolbar: { // Ìó§ÎçîÏóê ÌëúÏãúÌï† Ìà¥ Î∞î
                    left: 'title',
                    right: 'customBtn today prev next'
                },
                titleFormat: function(date) {
                    return (parseInt(date.date.month) + 1) + 'Ïõî' + "(Ï∂úÏÑùÏ≤¥ÌÅ¨ Ïù¥Î≤§Ìä∏)";
                },
                customButtons:{
                    customBtn :{
                        text: "Ï∂úÏÑùÏ≤¥ÌÅ¨ ÌïòÍ∏∞",
                        id : "checkBtn",
                        click : function (){
                            fetch("/user/addCheckEvent",{
                                method:'GET'
                            }).then( () =>{
                                calendar.refetchEvents();
                                setEventBtn();
                            } )
                        },
                    }
                },
                selectable: true, // ÎÇ†Ïßú ÏÑ†ÌÉù Ïó¨Î∂Ä ÏÑ§Ï†ï
                locale: 'ko', // ÌïúÍµ≠Ïñ¥ ÏÑ§Ï†ï
                fixedWeekCount: false,
                electMirror: false,
                events:function (info,addEvent){

                    fetch(`/user/getAllCheckEvent?start=${info.startStr}&end=${info.endStr}`,{
                        method:"GET"
                    }).then(response => response.json())
                        .then(data=>{
                            console.log("Ï∂úÏÑùÏ≤¥ÌÅ¨ Ïù¥Î≤§Ìä∏ data : ",data)

                            if (data.length > 0){
                                const events = data.map(data =>({
                                    title: "üç´",
                                    color : "#ffffff",
                                    start: data,
                                    allDay:true,
                                    background: "none",
                                }))

                                addEvent(events)
                                setEventBtn();
                            }

                        })
                }
            });

            calendar.render();
        });

        function setEventBtn(){
            fetch("/user/getCheckEvent",{
                method:'GET'
            }).then(response => response.json())
                .then(data =>{
                    if (data.result > 0){
                        document.querySelector('.fc-customBtn-button').style.display = 'none';
                    }else {
                        document.querySelector('.fc-customBtn-button').style.display = 'inline-block';
                    }
                })
        }

    </script>

    <script>
        const message = `[[${message}]]''`

        const viewAuth = '[[${LoginUserInfo.viewAuth}]]';
        const profileUrl = '[[${LoginUserInfo.profile}]]';

        const recently3List = '[[${recently3List}]]';
    </script>

    <script th:src="@{/js/mainPage/mainPage.js}"></script>
</body>
</html>