<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

<!--í°íŠ¸ ì ìš©-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/common/header.css}">
    <link rel="stylesheet" th:href="@{/css/common/footer.css}">
    <link rel="stylesheet" th:href="@{/css/common/style.css}">
    <!--ì—¬ê¸°ê¹Œì§€ ê³µë™ ë³µì‚¬-->

    <link rel="stylesheet" th:href="@{/css/mainPage/mainPage.css}">

</head>
<body>

    <header th:replace="~{common/header::headerFragment}"></header>
<!--    <section th:replace="~{/common/test::testFragment}"></section>-->
    <section>

<!--        <h1>Welcome, <span th:text="${userId}"></span>!</h1>-->

        <div class="holeContainer">
            <!-- í”„ë¡œí•„, ë‚ ì”¨ API, ì‚¬ë‚´ ë©”ì¼ -->
            <div class="main_upperBox">
                <div class="profileWeather">
                    <div class="profile">
    <!--                    <p th:text="${LoginUserInfo ?: 'User information is not available'}"></p>-->
    <!--                    <p id="todayAtt"></p>-->
                        <div class="profileImg">
                            <img th:src="${LoginUserInfo != null ?
                                        ( LoginUserInfo.profile != null && LoginUserInfo.profile != '' && !LoginUserInfo.profile.isEmpty()
                                        ? 'uploadImg/' + LoginUserInfo.profile : 'uploadImg/defaultImg.png')
                                        : 'uploadImg/defaultImg.png'}">
    <!--                        <img src="../static/images/loopy.jpg">-->
                        </div>
                        <div class="profileInfo" th:if="${LoginUserInfo}">
                            <div class="firstLine">
                                <div th:text="|ì´ ë¦„ : ${LoginUserInfo.empName}|"></div>
                                <p th:text="${LoginUserInfo.empId}"></p>
    <!--                         <div>ì´ ë¦„ : í™ê¸¸ë™</div>&ndash;&gt;-->
    <!--                         <p>12321</p>&ndash;&gt;-->
                                <button
                                        onclick="redirectBasedOnAuth()"
                                        id="linkedMyPage">
                                    + ë”ë³´ê¸°
                                </button>
                            </div>
                            <div class="secondLine" th:text="|ë¶€ ì„œ : ${LoginUserInfo.deptName}|"></div>
    <!--                    <div class="secondLine">ë¶€ ì„œ : í™ë³´ë¶€</div>-->

                            <div class="thirdLine">
                                <div th:text="|ì§ ì±… : ${LoginUserInfo.positionName}|"></div>
                                <div id="todayAtt"></div>

    <!--                        <div>ì§ ì±… : íŒ€ì¥</div>-->
    <!--                        <div id="todayAtt">ì§€ê°</div>-->
                            </div>
                        </div>
                    </div>
                    <div class="WeatherAPIBox">

                    </div>
                </div>

                <div class="companyMailBox">
                    <div class="mailBoxTitleBox">
                        <div class="mailBoxTitle">ì‚¬ë‚´ ë©”ì¼</div>
                        <div onclick="location.href='mail/receivedMails'">+ ë”ë³´ê¸°</div>
                    </div>

                    <div class="mailContent">
                        <div class="noMailMsg" th:if="!${receivedMails}">ë°›ì€ ë©”ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>

                        <div class="mailTh" th:if="${receivedMails}">
                            <div class="mailNum">ë²ˆí˜¸</div>
                            <div class="sender">ë³´ë‚¸ì‚¬ëŒ</div>
                            <div class="mailTitle">ì œëª©</div>
                            <div class="mailDate">ìˆ˜ì‹ ì¼</div>
                        </div>

                        <div th:onclick="|location.href='@{'/mail/detail'(emailId=${mail.mail.emailId})}'|" class="mailTd" th:each="mail, num : ${receivedMails}">
                            <div class="mailNum" th:text="${num.count}">ë²ˆí˜¸</div>
                            <div class="sender" th:text="${mail.senderName}">ë³´ë‚¸ì‚¬ëŒ</div>
                            <div class="mailTitle" th:text="${mail.mail.emailTitle}">ì œëª©</div>
                            <div class="mailDate" th:text="${mail.date}">ìˆ˜ì‹ ì¼</div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- ì¶œì„ì²´í¬ ì´ë²¤íŠ¸, íˆ¬í‘œ ìš”ì•½, ê²Œì‹œíŒ -->
            <div class="main_footerBox">
            <div class="checkEvent">
                <div id='checkCalendar'></div>
            </div>
            <div class="voteBoardSummary">
                <div class="voteSummary">
                    <div class="voteTitleBox">
                        <div class="voteTitle">íˆ¬í‘œ</div>
                    </div>
                    <div class="voteNone" th:unless="${recently3List} != null">ì•„ì§ íˆ¬í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                    <div th:if="${recently3List}" th:each="post, postStat : ${recently3List}"  th:data-num="${postStat.index}" class="voteContentBoxBox">
                        <div class="voteContentBox">
                            <div class="prevBtn" th:id="|prevBtn_${postStat.index}|">
                                <img src="/images/angle-left-solid.svg" alt="ì™¼ìª½ ì´ë™">
                            </div>
                            <div class="voteContent">
                                <div class="voteContentGle" th:text="${post.postContent}"></div>
                            </div>
                            <div class="nextBtn" th:id="|nextBtn_${postStat.index}|">
                                <img src="/images/angle-right-solid.svg" alt="ì™¼ìª½ ì´ë™">
                            </div>
                        </div>
                        <button class="moveVote" th:onclick="|location.href = '@{/board/postDetail(postId=${post.postId}, categoryCode=4)}'|">íˆ¬í‘œí•˜ëŸ¬ ê°€ê¸°</button>
                    </div>
                </div>
                <div class="boardSummary">
                    <div class="totalBox">
                        <div class="boardTitleBox">
                            <div class="boardTitle">ê²Œì‹œë¬¼</div>
                            <div onclick="location.href='board/list?categoryCode=1'">+ ë”ë³´ê¸°</div>
                        </div>

                        <div class="boardDataBox">
                            <!-- í…Œì´ë¸” í—¤ë” -->
                            <div class="DataHeader">
                                <div>ë²ˆí˜¸</div>
                                <div class="postEmpName">ì‘ì„±ì</div>
                                <div class="postTitle">ì œëª©</div>
                                <div class="postDate">ì‘ì„±ì¼</div>
                            </div>

                           <div class="DataBody">
                               <div class="MainData noPost" th:unless="${boardList} != null">ì—†ìŒ</div>
                               <div th:onclick="|location.href='@{/board/postDetail(postId=${board.postId}, categoryCode=${1})}'|" class="MainData" th:if="${boardList} != null" th:each="board, boardStat : ${boardList}">
                                   <div th:text="${boardStat.count}"></div>
                                   <div class="postEmpName" th:text="${board.empName}"></div>
                                   <div class="postTitle" th:text="${board.postTitle}"></div>
                                   <div class="postDate" th:text="${#temporals.format(board.postCreationDate, 'yyyy-MM-dd')}"></div>
                               </div>
                           </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

    </section>
    <footer th:replace="~{common/footer::footerFragment}"></footer>
    <canvas id="custom_canvas"></canvas>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/js-confetti@latest/dist/js-confetti.browser.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('custom_canvas')
            const jsConfetti = new JSConfetti({ canvas })

            var calendarEl = document.getElementById('checkCalendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth', // ì´ˆê¸° ë¡œë“œ ë ë•Œ ë³´ì´ëŠ” ìº˜ë¦°ë” í™”ë©´(ê¸°ë³¸ ì„¤ì •: ë‹¬)
                headerToolbar: { // í—¤ë”ì— í‘œì‹œí•  íˆ´ ë°”
                    left: 'title',
                    right: 'customBtn today prev next'
                },
                titleFormat: function(date) {
                    return (parseInt(date.date.month) + 1) + 'ì›”' + "(ì¶œì„ì²´í¬ ì´ë²¤íŠ¸)";
                },
                customButtons:{
                    customBtn :{
                        text: "ì¶œì„ì²´í¬ í•˜ê¸°",
                        id : "checkBtn",
                        click : function (){
                            fetch("/user/addCheckEvent",{
                                method:'GET'
                            }).then( () =>{
                                console.log("í´ë¦­í•¨")
                                calendar.refetchEvents();
                                setEventBtn();
                            } )

                            // JSConfetti ë™ì‘ ì¶”ê°€
                            jsConfetti.addConfetti({
                                emojis: ['ğŸ«', 'ğŸ°', 'ğŸ©', 'ğŸ¬', 'ğŸ­', 'ğŸªï¸'],
                                emojiSize: 80,
                                confettiNumber: 60,
                            });
                        },
                    }
                },
                selectable: true, // ë‚ ì§œ ì„ íƒ ì—¬ë¶€ ì„¤ì •
                locale: 'ko', // í•œêµ­ì–´ ì„¤ì •
                fixedWeekCount: false,
                electMirror: false,
                events:function (info,addEvent){

                    fetch(`/user/getAllCheckEvent?start=${info.startStr}&end=${info.endStr}`,{
                        method:"GET"
                    }).then(response => response.json())
                        .then(data=>{
                            console.log("ì¶œì„ì²´í¬ ì´ë²¤íŠ¸ data : ",data)

                            if (data.length > 0){
                                const events = data.map(data =>({
                                    title: "ğŸ«",
                                    color : "#ffffff",
                                    start: data,
                                    allDay:true,
                                    background: "none",
                                }))

                                addEvent(events)
                                setEventBtn();
                            }

                        })
                }
            });

            calendar.render();
        });

        function setEventBtn(){
            fetch("/user/getCheckEvent",{
                method:'GET'
            }).then(response => response.json())
                .then(data =>{
                    if (data.result > 0){
                        document.querySelector('.fc-customBtn-button').style.display = 'none';
                    }else {
                        document.querySelector('.fc-customBtn-button').style.display = 'inline-block';
                    }
                })
        }

    </script>

    <script>
        const message = `[[${message}]]''`

        const viewAuth = '[[${LoginUserInfo.viewAuth}]]';
        const profileUrl = '[[${LoginUserInfo.profile}]]';

        const recently3List = '[[${recently3List}]]';

        const receivedMails = '[[${receivedMails}]]'

        if (receivedMails){
            console.log("receivedMails: ",receivedMails)
        }

    </script>

    <script>
        const canvas = document.getElementById('custom_canvas')

    </script>

    <script th:src="@{/js/mainPage/mainPage.js}"></script>
</body>
</html>